### Test Forgot Password Flow (3 BƯỚC RIÊNG BIỆT)

### BƯỚC 1: Request OTP
POST http://localhost:8080/api/auth/forgot-password
Content-Type: application/json

{
  "email": "john@example.com"
}

### Expected Response:
# {
#   "message": "If your email exists in our system, you will receive an OTP code shortly."
# }
# → Kiểm tra email để lấy OTP 6 số

###

### BƯỚC 1b: Resend OTP (nếu chưa nhận được hoặc hết hạn)
POST http://localhost:8080/api/auth/resend-otp
Content-Type: application/json

{
  "email": "john@example.com"
}

###

### BƯỚC 2: Verify OTP → Nhận Reset Token
POST http://localhost:8080/api/auth/verify-otp
Content-Type: application/json

{
  "email": "john@example.com",
  "otp": "123456"
}

### Expected Response (Success):
# {
#   "message": "OTP verified successfully. Use the reset token to change your password.",
#   "resetToken": "eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJqb2huQGV4YW1wbGUuY29tIiwidHlwZSI6InBhc3N3b3JkX3Jlc2V0IiwiaWF0IjoxNzMwODI2MDAwLCJleHAiOjE3MzA4MjY5MDB9.xxx"
# }
# → Copy resetToken để dùng ở bước 3

###

### BƯỚC 3: Reset Password với Reset Token
POST http://localhost:8080/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "PASTE_RESET_TOKEN_HERE",
  "newPassword": "newPassword123",
  "confirmPassword": "newPassword123"
}

### Expected Response (Success):
# {
#   "message": "Password has been reset successfully."
# }

###

### BƯỚC 4: Test Login với password mới
POST http://localhost:8080/api/auth/login
Content-Type: application/json

{
  "email": "john@example.com",
  "password": "newPassword123"
}

### Expected Response (Success):
# {
#   "accessToken": "eyJhbGciOiJIUzUxMiJ9...",
#   "tokenType": "Bearer",
#   "user": { ... }
# }

###

### ============================================
### Test Cases - Error Scenarios
### ============================================

### 5. Test với email không tồn tại (vẫn trả về success - security)
POST http://localhost:8080/api/auth/forgot-password
Content-Type: application/json

{
  "email": "nonexistent@example.com"
}

###

### 6. Test với OTP sai
POST http://localhost:8080/api/auth/verify-otp
Content-Type: application/json

{
  "email": "john@example.com",
  "otp": "999999"
}

### Expected Response (Error):
# {
#   "message": "Invalid or expired OTP"
# }

###

### 7. Test với password không khớp
POST http://localhost:8080/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "PASTE_RESET_TOKEN_HERE",
  "newPassword": "newPassword123",
  "confirmPassword": "differentPassword"
}

### Expected Response (Error):
# {
#   "message": "New password and confirm password do not match"
# }

###

### 8. Test với reset token hết hạn (sau 15 phút)
POST http://localhost:8080/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "EXPIRED_TOKEN_HERE",
  "newPassword": "newPassword123",
  "confirmPassword": "newPassword123"
}

### Expected Response (Error):
# {
#   "message": "Reset token has expired"
# }

###

### 9. Test với reset token không hợp lệ
POST http://localhost:8080/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "invalid-token",
  "newPassword": "newPassword123",
  "confirmPassword": "newPassword123"
}

### Expected Response (Error):
# {
#   "message": "Invalid reset token"
# }

###

### 10. Test với password quá ngắn (validation error)
POST http://localhost:8080/api/auth/reset-password
Content-Type: application/json

{
  "resetToken": "PASTE_RESET_TOKEN_HERE",
  "newPassword": "123",
  "confirmPassword": "123"
}

### Expected Response (Error):
# {
#   "message": "Password must be at least 6 characters"
# }

###

### 11. Test sử dụng OTP 2 lần (OTP đã được dùng)
# Sau khi verify OTP thành công, thử verify lại OTP đó
POST http://localhost:8080/api/auth/verify-otp
Content-Type: application/json

{
  "email": "john@example.com",
  "otp": "123456"
}

### Expected Response (Error):
# {
#   "message": "OTP has already been used"
# }

###

### 12. Test với OTP đã hết hạn (sau 5 phút)
# Chờ 5 phút sau khi request OTP, rồi thử verify
POST http://localhost:8080/api/auth/verify-otp
Content-Type: application/json

{
  "email": "john@example.com",
  "otp": "123456"
}

### Expected Response (Error):
# {
#   "message": "OTP has expired"
# }

